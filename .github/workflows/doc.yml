name: Documentation

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  push:
    branches:
      - main
      - feature/github_actions
  workflow_dispatch:

jobs:
  build-documentation:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    
    # Build the HTML documentation
    - name: Doxygen Action
      uses: mattnotmitt/doxygen-action@v1.9.5
      with:
          doxyfile-path: ./Doxyfile
          working-directory: .
    # store the doc files
    - name: Upload Output Directory
      uses: actions/upload-artifact@v2
      with:
         name: doc-files
         path: doc
         retention-days: 1   
  copy:
     runs-on: ubuntu-latest
     needs: build-documentation
     # Grant GITHUB_TOKEN the permissions required to make a Pages deployment
     permissions:
         pages: write      # to deploy to Pages
         id-token: write   # to verify the deployment originates from an appropriate source
     steps:
     # checkout the gh-pages branch
     - uses: actions/checkout@v3
       with:
         ref: gh-pages
         token: ${{ secrets.GITHUB_TOKEN}}
       
     # download the doc files, most of which are generated above
     - name: Download Output Directory
       uses: actions/download-artifact@v2
       with:
         name: doc-files
         path: docDir
     # add, commit and push to gh-pages
     - name: Commit changes
       uses: EndBug/add-and-commit@v7
       env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       with:
         author_name: Konstantin
         message: 'Example docs'
         branch: gh-pages
         add: '["docDir/html/*"]'  
    
    # Deploy the HTML documentation to GitHub Pages===
    #- name: GH Pages Deployment
      #uses: peaceiris/actions-gh-pages@v3
      #with:
        #github_token: ${{ secrets.GITHUB_TOKEN }}
        #publish_dir: ./doc/html/
        #enable_jekyll: false
        #allow_empty_commit: false
        #force_orphan: true
        #publish_branch: gh-pages
